<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week - Cleaning Tracker</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <a href="index.html" class="back-btn">â†</a>
                <h1>ğŸ“… This Week</h1>
                <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
            </div>
            <div class="week-nav">
                <button class="nav-arrow" id="prevWeek">â€¹</button>
                <span class="week-range" id="weekRange">Loading...</span>
                <button class="nav-arrow" id="nextWeek">â€º</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <a href="index.html" class="nav-link">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">Home</span>
            </a>
            <a href="week.html" class="nav-link active">
                <span class="nav-icon">ğŸ“…</span>
                <span class="nav-text">Week</span>
            </a>
            <a href="tasks.html" class="nav-link">
                <span class="nav-icon">ğŸ“‹</span>
                <span class="nav-text">Tasks</span>
            </a>
            <a href="stats.html" class="nav-link">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-text">Stats</span>
            </a>
        </nav>

        <!-- Settings Bar -->
        <div class="settings-bar">
            <div class="setting-item">
                <span class="setting-label">Daily Budget:</span>
                <span class="setting-value" id="dailyBudget">30 min</span>
                <button class="setting-btn" onclick="showSettingsModal()">âš™ï¸</button>
            </div>
            <button class="btn btn-primary" onclick="smartSchedule()">
                âœ¨ Smart Schedule
            </button>
        </div>

        <!-- Week Grid -->
        <section class="week-grid" id="weekGrid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading week...</p>
            </div>
        </section>

        <!-- Selected Day Details -->
        <section class="day-details" id="dayDetails" style="display:none;">
            <div class="day-details-header">
                <h2 id="selectedDayTitle">Today</h2>
                <div class="day-details-meta">
                    <span id="selectedDayMeta">0 tasks â€¢ 0 min</span>
                </div>
            </div>

            <!-- Smart Tip -->
            <div class="smart-tip" id="smartTip" style="display:none;">
                <span class="tip-icon">ğŸ’¡</span>
                <span class="tip-text" id="tipText"></span>
            </div>

            <!-- Schedule Columns -->
            <div class="schedule-columns">
                <!-- To Do -->
                <div class="schedule-column">
                    <div class="column-header column-todo">
                        <h3>To Do</h3>
                        <span class="column-count" id="todoCount">0</span>
                    </div>
                    <div class="column-content" id="todoColumn">
                        <div class="empty-state">
                            <div class="empty-icon">âœ¨</div>
                            <p>No tasks scheduled</p>
                            <button class="btn btn-secondary" onclick="showScheduleTaskPicker()">
                                Schedule Task
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Done -->
                <div class="schedule-column">
                    <div class="column-header column-done">
                        <h3>Done</h3>
                        <span class="column-count" id="doneCount">0</span>
                    </div>
                    <div class="column-content" id="doneColumn">
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ¯</div>
                            <p>No completions yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAB -->
        <button class="fab" onclick="showScheduleTaskPicker()">
            <span>+</span>
        </button>
    </div>

    <!-- Schedule Task Modal -->
    <div class="modal" id="scheduleTaskModal">
        <div class="modal-overlay" onclick="closeScheduleTaskPicker()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Schedule Task</h3>
                <button class="modal-close" onclick="closeScheduleTaskPicker()">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="unscheduledTasksList" class="unscheduled-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading tasks...</p>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeScheduleTaskPicker()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-overlay" onclick="closeSettingsModal()"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Daily Time Budget</h3>
                <button class="modal-close" onclick="closeSettingsModal()">Ã—</button>
            </div>
            <form id="settingsForm" onsubmit="saveSettings(event)">
                <div class="form-group">
                    <label for="dailyMinutes">Minutes per day</label>
                    <select id="dailyMinutes">
                        <option value="15">15 minutes</option>
                        <option value="30" selected>30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60">1 hour</option>
                        <option value="90">1.5 hours</option>
                        <option value="120">2 hours</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Scripts -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/schedule.js"></script>
    <script type="module">
        import { loadWeekView, initWeekNavigation } from './js/schedule.js';
        
        document.addEventListener('DOMContentLoaded', async () => {
            await loadWeekView();
            initWeekNavigation();
        });
    </script>
</body>
</html>