<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks - Cleaning Tracker</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <a href="index.html" class="back-btn">‚Üê</a>
                <h1>üìã All Tasks</h1>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <a href="index.html" class="nav-link">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Home</span>
            </a>
            <a href="week.html" class="nav-link">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-text">Week</span>
            </a>
            <a href="tasks.html" class="nav-link active">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">Tasks</span>
            </a>
            <a href="stats.html" class="nav-link">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Stats</span>
            </a>
        </nav>

        <!-- Filters -->
        <section class="filters-section">
            <div class="filter-group">
                <h3>Status</h3>
                <div class="filter-chips">
                    <button class="filter-chip active" data-filter="all" onclick="filterTasks('status', 'all')">All</button>
                    <button class="filter-chip" data-filter="overdue" onclick="filterTasks('status', 'overdue')">Overdue</button>
                    <button class="filter-chip" data-filter="due-soon" onclick="filterTasks('status', 'due-soon')">Due Soon</button>
                    <button class="filter-chip" data-filter="on-track" onclick="filterTasks('status', 'on-track')">On Track</button>
                </div>
            </div>
            <div class="filter-group">
                <h3>Floor</h3>
                <div class="filter-chips">
                    <button class="filter-chip active" data-filter="all" onclick="filterTasks('floor', 'all')">All</button>
                    <button class="filter-chip" data-filter="first" onclick="filterTasks('floor', 'first')">First Floor</button>
                    <button class="filter-chip" data-filter="second" onclick="filterTasks('floor', 'second')">Second Floor</button>
                    <button class="filter-chip" data-filter="basement" onclick="filterTasks('floor', 'basement')">Basement</button>
                    <button class="filter-chip" data-filter="garage" onclick="filterTasks('floor', 'garage')">Garage</button>
                </div>
            </div>
            <div class="filter-group">
                <h3>Effort</h3>
                <div class="filter-chips">
                    <button class="filter-chip active" data-filter="all" onclick="filterTasks('effort', 'all')">All</button>
                    <button class="filter-chip" data-filter="low" onclick="filterTasks('effort', 'low')">Low</button>
                    <button class="filter-chip" data-filter="medium" onclick="filterTasks('effort', 'medium')">Medium</button>
                    <button class="filter-chip" data-filter="high" onclick="filterTasks('effort', 'high')">High</button>
                </div>
            </div>
        </section>

        <!-- Tasks List -->
        <section class="section">
            <div class="section-header">
                <h2>
                    <span id="taskCount">0</span> Tasks
                </h2>
                <button class="btn btn-primary" onclick="showAddTaskModal()">
                    + Add Task
                </button>
            </div>
            <div id="tasksList" class="tasks-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading tasks...</p>
                </div>
            </div>
        </section>

        <!-- FAB -->
        <button class="fab" onclick="showAddTaskModal()">
            <span>+</span>
        </button>
    </div>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-overlay" onclick="closeTaskModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Task</h3>
                <button class="modal-close" onclick="closeTaskModal()">√ó</button>
            </div>
            <form id="taskForm" onsubmit="saveTask(event)">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label for="editTaskName">Task Name</label>
                    <input type="text" id="editTaskName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editTaskFloor">Floor</label>
                        <select id="editTaskFloor">
                            <option value="">Select...</option>
                            <option value="First Floor">First Floor</option>
                            <option value="Second Floor">Second Floor</option>
                            <option value="Basement">Basement</option>
                            <option value="Garage">Garage</option>
                            <option value="Exterior">Exterior</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskCategory">Room</label>
                        <input type="text" id="editTaskCategory">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editTaskCadence">Frequency</label>
                        <select id="editTaskCadence" required>
                            <option value="1">Daily</option>
                            <option value="3">Every 3 days</option>
                            <option value="7">Weekly</option>
                            <option value="14">Bi-weekly</option>
                            <option value="30">Monthly</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTaskTime">Time (min)</label>
                        <input type="number" id="editTaskTime" min="1" max="300">
                    </div>
                </div>
                <div class="form-group">
                    <label for="editTaskEffort">Effort</label>
                    <select id="editTaskEffort">
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" id="deleteBtn" onclick="deleteTask()" style="display:none">
                        Delete
                    </button>
                    <div style="flex:1"></div>
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Scripts -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module">
        import { loadAllTasks, currentFilters, applyFilters } from './js/app.js';
        
        document.addEventListener('DOMContentLoaded', async () => {
            await loadAllTasks();
        });

        // Make filter function global
        window.filterTasks = (filterType, filterValue) => {
            // Update active state
            document.querySelectorAll(`.filter-chips button`).forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update filters
            currentFilters[filterType] = filterValue;
            applyFilters();
        };
    </script>
</body>
</html>